<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=0.8, maximum-scale=1.0, user-scalable=no">
    <title>I AM MUGERA</title>
    <link rel="icon" type="image/x-icon" href="https://i.postimg.cc/c4CzSQzq/Whats-App-Image-2025-11-13-at-14-53-50-1-removebg-preview.png">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        :root {
            --black: #000000;
            --white: #ffffff;
            --gray: #f5f5f5;
            --dark-gray: #333333;
            --light-gray: #e0e0e0;
            --accent: #25D366;
            --google-blue: #4285F4;
        }

        html {
            scroll-behavior: smooth;
        }

        body {
            background-color: var(--white);
            color: var(--black);
            line-height: 1.6;
            padding-bottom: 70px;
        }

        /* Header Styles */
        header {
            background-color: var(--white);
            color: var(--black);
            padding: 0.5rem 1rem;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            border-bottom: 1px solid var(--light-gray);
            height: 60px;
        }

        .header-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            height: 100%;
        }

        .logo {
            display: flex;
            align-items: center;
        }

        .logo img {
            height: 40px;
            width: auto;
        }

        .auth-section {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .user-profile {
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            padding: 5px 10px;
            border-radius: 20px;
            transition: background-color 0.3s;
        }

        .user-profile:hover {
            background-color: var(--light-gray);
        }

        .user-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            object-fit: cover;
        }

        .user-name {
            font-size: 0.9rem;
            font-weight: 500;
        }

        .login-btn {
            background-color: var(--google-blue);
            color: white;
            border: none;
            border-radius: 4px;
            padding: 8px 16px;
            font-size: 0.9rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: background-color 0.3s;
        }

        .login-btn:hover {
            background-color: #3367D6;
        }

        /* Auth Modal */
        .auth-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .auth-modal.active {
            display: flex;
        }

        .auth-content {
            background-color: white;
            padding: 2rem;
            border-radius: 8px;
            width: 90%;
            max-width: 400px;
            text-align: center;
        }

        .auth-content h2 {
            margin-bottom: 1rem;
            color: var(--black);
        }

        .auth-content p {
            margin-bottom: 1.5rem;
            color: var(--dark-gray);
        }

        .close-modal {
            position: absolute;
            top: 10px;
            right: 10px;
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--dark-gray);
        }

        /* Custom Google Button */
        .custom-google-btn {
            background: white;
            color: #757575;
            border: 1px solid #dadce0;
            border-radius: 4px;
            padding: 12px 16px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            width: 100%;
            max-width: 300px;
            margin: 0 auto;
            transition: background-color 0.3s, box-shadow 0.3s;
        }

        .custom-google-btn:hover {
            background: #f8f9fa;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .custom-google-btn img {
            width: 18px;
            height: 18px;
        }

        /* Profile Section */
        .profile-section {
            background-color: var(--white);
            border: 1px solid var(--light-gray);
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            display: none;
        }

        .profile-section.active {
            display: block;
        }

        .profile-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 1rem;
        }

        .profile-avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            object-fit: cover;
            border: 3px solid var(--light-gray);
        }

        .profile-info h2 {
            margin-bottom: 5px;
        }

        .profile-info p {
            color: var(--dark-gray);
            font-size: 0.9rem;
        }

        .profile-stats {
            display: flex;
            gap: 20px;
            margin: 1rem 0;
            padding: 1rem 0;
            border-top: 1px solid var(--light-gray);
            border-bottom: 1px solid var(--light-gray);
        }

        .stat {
            text-align: center;
        }

        .stat-value {
            font-weight: bold;
            font-size: 1.2rem;
        }

        .stat-label {
            font-size: 0.8rem;
            color: var(--dark-gray);
        }

        .profile-actions {
            display: flex;
            gap: 10px;
            margin-top: 1rem;
            flex-wrap: wrap;
        }

        .profile-btn {
            padding: 8px 16px;
            border: 1px solid var(--light-gray);
            background: white;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.9rem;
        }

        .profile-btn.primary {
            background: var(--black);
            color: white;
            border-color: var(--black);
        }

        .profile-btn:hover {
            background: var(--light-gray);
        }

        .profile-btn.primary:hover {
            background: var(--dark-gray);
        }

        /* Loading spinner */
        .loading {
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 2px solid #f3f3f3;
            border-top: 2px solid var(--google-blue);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Notification */
        .notification {
            position: fixed;
            top: 70px;
            right: 20px;
            background: var(--black);
            color: white;
            padding: 12px 20px;
            border-radius: 4px;
            z-index: 1000;
            opacity: 0;
            transform: translateY(-20px);
            transition: all 0.3s;
            max-width: 300px;
        }

        .notification.show {
            opacity: 1;
            transform: translateY(0);
        }

        .notification.error {
            background: #e74c3c;
        }

        .notification.success {
            background: var(--accent);
        }

        /* Manual Auth Form */
        .manual-auth {
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px solid var(--light-gray);
        }

        .manual-auth input {
            width: 100%;
            padding: 10px;
            margin: 5px 0;
            border: 1px solid var(--light-gray);
            border-radius: 4px;
            font-size: 14px;
        }

        .manual-auth button {
            width: 100%;
            padding: 10px;
            background: var(--black);
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin-top: 10px;
        }

        /* Main Content */
        .container {
            max-width: 600px;
            margin: 0 auto;
            padding: 1rem;
        }

        /* Posts */
        .post {
            background-color: var(--white);
            border: 1px solid var(--light-gray);
            border-radius: 8px;
            overflow: hidden;
            margin-bottom: 1.5rem;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
        }

        .post-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 1rem;
        }

        .post-user-info {
            display: flex;
            align-items: center;
        }

        .post-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            overflow: hidden;
            margin-right: 10px;
            background: var(--white);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .post-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .post-user {
            font-weight: 600;
        }

        .post-category {
            font-size: 0.8rem;
            color: var(--dark-gray);
        }

        .post-media {
            width: 100%;
            overflow: hidden;
            position: relative;
        }

        .post-image {
            width: 100%;
            height: auto;
            display: block;
        }

        .post-video {
            width: 100%;
            height: 400px;
            background: var(--black);
            position: relative;
        }

        .video-container {
            width: 100%;
            height: 100%;
            position: relative;
        }

        .google-vid-embed {
            width: 100%;
            height: 100%;
            border: none;
        }

        .video-placeholder {
            width: 100%;
            height: 100%;
            background: var(--black);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--white);
            font-size: 1.2rem;
        }

        .video-controls {
            position: absolute;
            bottom: 10px;
            left: 10px;
            right: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .post-video:hover .video-controls {
            opacity: 1;
        }

        .play-pause-btn {
            background: rgba(0, 0, 0, 0.7);
            border: none;
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 1.2rem;
        }

        .post-actions {
            display: flex;
            justify-content: space-between;
            padding: 0.8rem 1rem;
            border-bottom: 1px solid var(--light-gray);
        }

        .action-left {
            display: flex;
            gap: 15px;
        }

        .post-action {
            background: none;
            border: none;
            font-size: 1.3rem;
            cursor: pointer;
            color: var(--dark-gray);
            transition: color 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .post-action:hover {
            color: var(--black);
        }

        .post-action.active {
            color: #e74c3c;
        }

        .whatsapp-action {
            background-color: var(--accent);
            color: white;
            width: 44px;
            height: 44px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            text-decoration: none;
            font-size: 1.3rem;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
            transition: transform 0.3s;
        }

        .whatsapp-action:hover {
            transform: scale(1.1);
        }

        .post-content {
            padding: 0 1rem 1rem;
        }

        .post-caption {
            margin-bottom: 10px;
        }

        .post-time {
            color: var(--dark-gray);
            font-size: 0.8rem;
            margin-bottom: 5px;
        }

        .post-type {
            background-color: var(--black);
            color: var(--white);
            padding: 0.2rem 0.6rem;
            border-radius: 12px;
            font-size: 0.7rem;
            display: inline-block;
        }

        /* Bottom Navigation */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background-color: var(--white);
            display: flex;
            justify-content: space-around;
            padding: 0.8rem 0;
            z-index: 100;
            border-top: 1px solid var(--light-gray);
        }

        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            color: var(--dark-gray);
            text-decoration: none;
            font-size: 0.8rem;
            transition: color 0.3s;
        }

        .nav-icon {
            font-size: 1.3rem;
            margin-bottom: 3px;
        }

        .nav-item.active {
            color: var(--black);
        }

        .nav-item:hover {
            color: var(--black);
        }

        /* Contact Section */
        .contact-section {
            background-color: var(--gray);
            border-radius: 8px;
            padding: 1.5rem;
            margin: 2rem 0;
            text-align: center;
        }

        .contact-section h3 {
            margin-bottom: 1rem;
        }

        .contact-buttons {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 1rem;
        }

        .contact-btn {
            background-color: var(--black);
            color: var(--white);
            border: none;
            border-radius: 5px;
            padding: 10px 20px;
            text-decoration: none;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: background-color 0.3s;
        }

        .contact-btn:hover {
            background-color: var(--dark-gray);
        }

        /* Responsive Design */
        @media (min-width: 768px) {
            .container {
                max-width: 600px;
            }
            
            .post-video {
                height: 500px;
            }
        }

        @media (max-width: 480px) {
            .post-video {
                height: 300px;
            }
            
            .user-name {
                display: none;
            }
            
            .profile-header {
                flex-direction: column;
                text-align: center;
            }
            
            .profile-actions {
                justify-content: center;
            }
            
            .notification {
                right: 10px;
                left: 10px;
                max-width: none;
            }
        }
    </style>
</head>
<body>
    <!-- Notification -->
    <div class="notification" id="notification"></div>

    <!-- Header -->
    <header>
        <div class="header-container">
            <div class="logo">
                <img src="https://i.postimg.cc/c4CzSQzq/Whats-App-Image-2025-11-13-at-14-53-50-1-removebg-preview.png" alt="I AM MUGERA Logo">
            </div>
            <div class="auth-section">
                <div class="user-profile" id="userProfile" style="display: none;">
                    <img src="" alt="User Avatar" class="user-avatar" id="userAvatar">
                    <span class="user-name" id="userName"></span>
                </div>
                <button class="login-btn" id="loginBtn">
                    <i class="fab fa-google"></i>
                    <span>Sign In</span>
                </button>
            </div>
        </div>
    </header>

    <!-- Auth Modal -->
    <div class="auth-modal" id="authModal">
        <div class="auth-content">
            <button class="close-modal" id="closeModal">&times;</button>
            <h2>Join I AM MUGERA</h2>
            <p>Sign in to create your profile, save posts, and join the community</p>
            
            <!-- Google Sign In Button Container -->
            <div id="googleSignInButton"></div>
            
            <!-- Custom Google Button as Fallback -->
            <button class="custom-google-btn" id="customGoogleBtn" style="display: none;">
                <img src="https://developers.google.com/identity/images/g-logo.png" alt="Google Logo">
                Sign in with Google
            </button>
            
            <!-- Manual Auth Fallback -->
            <div class="manual-auth" id="manualAuth" style="display: none;">
                <p style="font-size: 0.9rem; color: var(--dark-gray); margin-bottom: 1rem;">
                    Having trouble with Google Sign-In? Enter your details:
                </p>
                <input type="text" id="manualName" placeholder="Your Name" required>
                <input type="email" id="manualEmail" placeholder="Your Email" required>
                <button id="manualSignIn">Create Profile</button>
            </div>
            
            <!-- Fallback Toggle -->
            <p style="margin-top: 1rem;">
                <a href="#" id="toggleFallback" style="color: var(--google-blue); text-decoration: none; font-size: 0.9rem;">
                    Having trouble? Try alternative sign-in
                </a>
            </p>
        </div>
    </div>

    <!-- Main Content -->
    <main class="container">
        <!-- User Profile Section -->
        <div class="profile-section" id="profileSection">
            <div class="profile-header">
                <img src="" alt="Profile Picture" class="profile-avatar" id="profileAvatar">
                <div class="profile-info">
                    <h2 id="profileName">User Name</h2>
                    <p id="profileEmail">user@example.com</p>
                    <p>Member since <span id="memberSince">2025</span></p>
                </div>
            </div>
            <div class="profile-stats">
                <div class="stat">
                    <div class="stat-value" id="savedPostsCount">0</div>
                    <div class="stat-label">Saved Posts</div>
                </div>
                <div class="stat">
                    <div class="stat-value" id="daysActive">1</div>
                    <div class="stat-label">Days Active</div>
                </div>
                <div class="stat">
                    <div class="stat-value" id="communityRank">New</div>
                    <div class="stat-label">Community Rank</div>
                </div>
            </div>
            <div class="profile-actions">
                <button class="profile-btn" id="editProfileBtn">Edit Profile</button>
                <button class="profile-btn primary" id="viewSavedBtn">View Saved Posts</button>
                <button class="profile-btn" id="logoutBtn">Logout</button>
            </div>
        </div>

        <!-- Post 1 - Brand Introduction -->
        <div class="post" id="post-1">
            <div class="post-header">
                <div class="post-user-info">
                    <div class="post-avatar">
                        <img src="https://i.postimg.cc/c4CzSQzq/Whats-App-Image-2025-11-13-at-14-53-50-1-removebg-preview.png" alt="I AM MUGERA Logo">
                    </div>
                    <div>
                        <div class="post-user">iam_mugera</div>
                        <div class="post-category">Brand Introduction</div>
                    </div>
                </div>
            </div>
            <div class="post-media">
                <img src="https://i.postimg.cc/c4CzSQzq/Whats-App-Image-2025-11-13-at-14-53-50-1-removebg-preview.png" alt="Brand Vision" class="post-image">
            </div>
            <div class="post-actions">
                <div class="action-left">
                    <button class="post-action save-btn" title="Save post" data-post-id="1">
                        <i class="far fa-bookmark"></i>
                    </button>
                </div>
                <a href="https://wa.me/254727211191?text=Hi%20Mugera,%20I%20want%20to%20learn%20more%20about%20your%20brand" class="whatsapp-action" title="Contact via WhatsApp">
                    <i class="fab fa-whatsapp"></i>
                </a>
            </div>
            <div class="post-content">
                <div class="post-caption">
                    <strong>Welcome to I AM MUGERA</strong><br><br>
                    This is more than just a brand - it's a movement. A platform dedicated to awakening consciousness, empowering individuals, and creating meaningful change in our society.<br><br>
                    Through content, conversations, and community, we explore what it means to live with purpose, authenticity, and impact. Whether you're here for inspiration, education, or connection, you're in the right place.<br><br>
                    This is where we challenge norms, break barriers, and build together. Welcome to the journey.
                </div>
                <div class="post-time" id="post-1-time"></div>
                <span class="post-type">INTRODUCTION</span>
            </div>
        </div>

        <!-- Post 2 - Commercial Video -->
        <div class="post" id="post-2">
            <div class="post-header">
                <div class="post-user-info">
                    <div class="post-avatar">
                        <img src="https://i.postimg.cc/c4CzSQzq/Whats-App-Image-2025-11-13-at-14-53-50-1-removebg-preview.png" alt="I AM MUGERA Logo">
                    </div>
                    <div>
                        <div class="post-user">iam_mugera</div>
                        <div class="post-category">Commercial</div>
                    </div>
                </div>
            </div>
            <div class="post-media">
                <div class="post-video">
                    <div class="video-container">
                        <iframe 
                            src="https://docs.google.com/videos/d/1Ozl8WCVOSopprrwoDiU9I8tr0ap8dP4m8XoaNpEgTbw/edit?usp=sharing" 
                            class="google-vid-embed"
                            allow="autoplay"
                            frameborder="0"
                            allowfullscreen>
                        </iframe>
                    </div>
                    <div class="video-controls">
                        <button class="play-pause-btn">
                            <i class="fas fa-pause"></i>
                        </button>
                    </div>
                </div>
            </div>
            <div class="post-actions">
                <div class="action-left">
                    <button class="post-action save-btn" title="Save post" data-post-id="2">
                        <i class="far fa-bookmark"></i>
                    </button>
                </div>
                <a href="https://wa.me/254727211191?text=Hi%20Mugera,%20I%20just%20watched%20your%20commercial%20about%20awakening%20men" class="whatsapp-action" title="Contact via WhatsApp">
                    <i class="fab fa-whatsapp"></i>
                </a>
            </div>
            <div class="post-content">
                <div class="post-caption">
                    <strong>Awakening Men in Society</strong><br><br>
                    This commercial addresses the crucial need for conscious masculinity in our modern world. We explore what it means to be a man who leads with purpose, integrity, and emotional intelligence.<br><br>
                    The awakening begins within - recognizing our power, embracing vulnerability, and stepping into our roles as builders, protectors, and healers of our communities.<br><br>
                    Join the conversation. Share your thoughts. Let's build better men for a better world.
                </div>
                <div class="post-time" id="post-2-time"></div>
                <span class="post-type">COMMERCIAL</span>
            </div>
        </div>

        <!-- Post 3 - Mugs and Dines -->
        <div class="post" id="post-3">
            <div class="post-header">
                <div class="post-user-info">
                    <div class="post-avatar">
                        <img src="https://i.postimg.cc/c4CzSQzq/Whats-App-Image-2025-11-13-at-14-53-50-1-removebg-preview.png" alt="I AM MUGERA Logo">
                    </div>
                    <div>
                        <div class="post-user">iam_mugera</div>
                        <div class="post-category">Dining Program</div>
                    </div>
                </div>
            </div>
            <div class="post-media">
                <img src="https://images.unsplash.com/photo-1517248135467-4c7edcad34c4?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1000&q=80" alt="Mugs and Dines Dining Experience" class="post-image">
            </div>
            <div class="post-actions">
                <div class="action-left">
                    <button class="post-action save-btn" title="Save post" data-post-id="3">
                        <i class="far fa-bookmark"></i>
                    </button>
                </div>
                <a href="https://wa.me/254727211191?text=Hi%20Mugera,%20I'm%20interested%20in%20the%20Mugs%20and%20Dines%20program" class="whatsapp-action" title="Contact via WhatsApp">
                    <i class="fab fa-whatsapp"></i>
                </a>
            </div>
            <div class="post-content">
                <div class="post-caption">
                    <strong>Mugs and Dines: Conversations Over Cuisine</strong><br><br>
                    <strong>What to Expect:</strong><br>
                    • Intimate dining experiences with limited seating<br>
                    • Guided conversations on relevant relationship topics<br>
                    • Shared stories and collective wisdom<br>
                    • Practical tools for strengthening connections<br>
                    • Networking with like-minded individuals<br><br>
                    Whether you're navigating the complexities of modern relationships, seeking to strengthen your marriage, or looking to build healthier family dynamics, Mugs and Dines provides the space, community, and insights to support your journey.
                </div>
                <div class="post-time" id="post-3-time"></div>
                <span class="post-type">DINING PROGRAM</span>
            </div>
        </div>

        <!-- Contact Section -->
        <div class="contact-section">
            <h3>Join The Movement</h3>
            <p>Ready to awaken your potential and be part of the change? Connect with me directly:</p>
            <div class="contact-buttons">
                <a href="https://wa.me/254727211191" class="contact-btn">
                    <i class="fab fa-whatsapp"></i> WhatsApp
                </a>
                <a href="mailto:contact@iammugera.com" class="contact-btn">
                    <i class="fas fa-envelope"></i> Email
                </a>
            </div>
        </div>
    </main>

    <!-- Bottom Navigation -->
    <nav class="bottom-nav">
        <a href="index.html" class="nav-item active">
            <i class="fas fa-home nav-icon"></i>
            <span>Home</span>
        </a>
        <a href="events.html" class="nav-item">
            <i class="fas fa-calendar-alt nav-icon"></i>
            <span>Events</span>
        </a>
        <a href="library.html" class="nav-item">
            <i class="fas fa-book nav-icon"></i>
            <span>Library</span>
        </a>
        <a href="about.html" class="nav-item">
            <i class="fas fa-info-circle nav-icon"></i>
            <span>About</span>
        </a>
    </nav>

    <!-- Google Identity Services with Fallback -->
    <script src="https://accounts.google.com/gsi/client" async defer onerror="handleGoogleScriptError()"></script>
    <script>
        // Configuration
        const BACKEND_URL = 'https://script.google.com/macros/s/AKfycbwCo8RkC1zka9RxW1YiDxuPzzCPWqtl2_ZqE_TlBDxLYFFMxHCLoTVZz6nBUR_SaAVC7w/exec';
        const GOOGLE_CLIENT_ID = '230366555128-bkm4jhc3c14scafm8808uk8u456u6cfk.apps.googleusercontent.com';
        
        // User state
        let currentUser = null;
        let googleAuthLoaded = false;

        // DOM Elements
        const loginBtn = document.getElementById('loginBtn');
        const authModal = document.getElementById('authModal');
        const closeModal = document.getElementById('closeModal');
        const userProfileElement = document.getElementById('userProfile');
        const userNameElement = document.getElementById('userName');
        const userAvatarElement = document.getElementById('userAvatar');
        const profileSection = document.getElementById('profileSection');
        const profileNameElement = document.getElementById('profileName');
        const profileEmailElement = document.getElementById('profileEmail');
        const profileAvatarElement = document.getElementById('profileAvatar');
        const memberSinceElement = document.getElementById('memberSince');
        const savedPostsCountElement = document.getElementById('savedPostsCount');
        const daysActiveElement = document.getElementById('daysActive');
        const communityRankElement = document.getElementById('communityRank');
        const logoutBtn = document.getElementById('logoutBtn');
        const notification = document.getElementById('notification');
        const customGoogleBtn = document.getElementById('customGoogleBtn');
        const manualAuth = document.getElementById('manualAuth');
        const toggleFallback = document.getElementById('toggleFallback');
        const manualSignIn = document.getElementById('manualSignIn');

        // Handle Google Script Loading Error
        function handleGoogleScriptError() {
            console.warn('Google Identity Services failed to load, using fallback authentication');
            googleAuthLoaded = false;
            showFallbackAuth();
        }

        // Show fallback authentication options
        function showFallbackAuth() {
            document.getElementById('googleSignInButton').style.display = 'none';
            customGoogleBtn.style.display = 'block';
            showNotification('Using alternative sign-in method', 'success');
        }

        // Backend API Functions
        async function backendRequest(action, data = null, method = 'POST') {
            const url = `${BACKEND_URL}?action=${action}`;
            
            try {
                const options = {
                    method: method,
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    redirect: 'follow'
                };
                
                if (data && method === 'POST') {
                    options.body = JSON.stringify(data);
                }
                
                const response = await fetch(url, options);
                const result = await response.json();
                
                if (result.error) {
                    throw new Error(result.error);
                }
                
                return result;
            } catch (error) {
                console.error('Backend request failed:', error);
                showNotification('Network error. Please try again.', 'error');
                throw error;
            }
        }

        // User management functions
        async function createUser(userData) {
            return await backendRequest('createUser', userData);
        }

        async function getUserProfile(userId) {
            const url = `${BACKEND_URL}?action=getUserProfile&userId=${encodeURIComponent(userId)}`;
            const response = await fetch(url);
            return await response.json();
        }

        async function savePost(userId, postId) {
            return await backendRequest('savePost', { userId, postId });
        }

        async function unsavePost(userId, postId) {
            return await backendRequest('unsavePost', { userId, postId });
        }

        // Show notification
        function showNotification(message, type = 'success') {
            notification.textContent = message;
            notification.className = `notification show ${type}`;
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        // Initialize Google Sign In with retry logic
        function initializeGoogleSignIn() {
            if (typeof google === 'undefined') {
                console.warn('Google object not available, retrying in 1 second...');
                setTimeout(initializeGoogleSignIn, 1000);
                return;
            }

            try {
                google.accounts.id.initialize({
                    client_id: GOOGLE_CLIENT_ID,
                    callback: handleCredentialResponse,
                    auto_select: false,
                    cancel_on_tap_outside: true
                });

                google.accounts.id.renderButton(
                    document.getElementById('googleSignInButton'),
                    { 
                        theme: 'outline', 
                        size: 'large',
                        width: 300,
                        text: 'signin_with',
                        shape: 'rectangular'
                    }
                );
                
                googleAuthLoaded = true;
                console.log('Google Sign-In initialized successfully');
            } catch (error) {
                console.error('Google Sign-In initialization failed:', error);
                showFallbackAuth();
            }
        }

        // Handle Google Sign In Response
        async function handleCredentialResponse(response) {
            console.log('Google Sign-In response received');
            
            try {
                showLoading(loginBtn);
                
                // Decode the JWT token to get user info
                const responsePayload = decodeJWTResponse(response.credential);
                
                if (responsePayload) {
                    await processUserSignIn({
                        userId: responsePayload.sub,
                        name: responsePayload.name,
                        email: responsePayload.email,
                        picture: responsePayload.picture
                    });
                }
            } catch (error) {
                console.error('Sign in failed:', error);
                showNotification('Sign in failed. Please try again.', 'error');
            } finally {
                hideLoading(loginBtn);
            }
        }

        // Process user sign in (common for both Google and manual auth)
        async function processUserSignIn(userData) {
            try {
                // Create user in backend
                const result = await createUser(userData);
                
                currentUser = {
                    ...userData,
                    ...result.user
                };

                // Load complete user data
                const userProfile = await getUserProfile(currentUser.userId);
                if (userProfile && userProfile.user) {
                    currentUser = { ...currentUser, ...userProfile.user };
                }

                // Update UI
                updateUserInterface();
                
                // Close modal
                authModal.classList.remove('active');
                
                showNotification(`Welcome to I AM MUGERA, ${currentUser.name}!`);
                console.log('User signed in:', currentUser.name);
                
                // Save to localStorage for session persistence
                localStorage.setItem('iam_mugera_user', JSON.stringify(currentUser));
            } catch (error) {
                console.error('User processing failed:', error);
                throw error;
            }
        }

        // Manual authentication handler
        async function handleManualAuth() {
            const name = document.getElementById('manualName').value.trim();
            const email = document.getElementById('manualEmail').value.trim();
            
            if (!name || !email) {
                showNotification('Please enter both name and email', 'error');
                return;
            }
            
            if (!validateEmail(email)) {
                showNotification('Please enter a valid email address', 'error');
                return;
            }
            
            try {
                showLoading(manualSignIn);
                
                await processUserSignIn({
                    userId: 'manual_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9),
                    name: name,
                    email: email,
                    picture: 'https://ui-avatars.com/api/?name=' + encodeURIComponent(name) + '&background=random'
                });
            } catch (error) {
                console.error('Manual auth failed:', error);
                showNotification('Failed to create profile. Please try again.', 'error');
            } finally {
                hideLoading(manualSignIn);
            }
        }

        // Email validation
        function validateEmail(email) {
            const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            return re.test(email);
        }

        // Decode JWT token
        function decodeJWTResponse(token) {
            try {
                const base64Url = token.split('.')[1];
                const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
                const jsonPayload = decodeURIComponent(atob(base64).split('').map(function(c) {
                    return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
                }).join(''));

                return JSON.parse(jsonPayload);
            } catch (error) {
                console.error('Error decoding JWT:', error);
                return null;
            }
        }

        // Show loading state
        function showLoading(button) {
            const originalText = button.innerHTML;
            button.disabled = true;
            button.innerHTML = '<div class="loading"></div>';
            button.setAttribute('data-original-text', originalText);
        }

        // Hide loading state
        function hideLoading(button) {
            button.disabled = false;
            const originalText = button.getAttribute('data-original-text');
            button.innerHTML = originalText || '<i class="fab fa-google"></i><span>Sign In</span>';
        }

        // Update user interface based on auth state
        async function updateUserInterface() {
            if (currentUser) {
                // User is signed in
                loginBtn.style.display = 'none';
                userProfileElement.style.display = 'flex';
                
                // Update header user info
                userNameElement.textContent = currentUser.name;
                userAvatarElement.src = currentUser.picture;
                
                // Update profile section
                profileSection.classList.add('active');
                profileNameElement.textContent = currentUser.name;
                profileEmailElement.textContent = currentUser.email;
                profileAvatarElement.src = currentUser.picture;
                
                // Calculate and display profile stats
                const joinDate = new Date(currentUser.createdAt || new Date());
                const daysActive = calculateDaysActive(joinDate);
                const savedPosts = currentUser.savedPosts || [];
                const communityRank = getCommunityRank(daysActive, savedPosts.length);
                
                memberSinceElement.textContent = joinDate.getFullYear();
                daysActiveElement.textContent = daysActive;
                savedPostsCountElement.textContent = savedPosts.length;
                communityRankElement.textContent = communityRank;
                
                // Update save buttons state
                updateSaveButtonsState(savedPosts);
                
            } else {
                // User is signed out
                loginBtn.style.display = 'flex';
                userProfileElement.style.display = 'none';
                profileSection.classList.remove('active');
                
                // Reset save buttons
                document.querySelectorAll('.save-btn').forEach(btn => {
                    const icon = btn.querySelector('i');
                    icon.classList.remove('fas');
                    icon.classList.add('far');
                    btn.classList.remove('active');
                    btn.title = 'Save post';
                });
            }
        }

        // Update save buttons based on saved posts
        function updateSaveButtonsState(savedPosts) {
            document.querySelectorAll('.save-btn').forEach(btn => {
                const postId = btn.getAttribute('data-post-id');
                if (savedPosts && savedPosts.includes(postId)) {
                    const icon = btn.querySelector('i');
                    icon.classList.remove('far');
                    icon.classList.add('fas');
                    btn.classList.add('active');
                    btn.title = 'Remove from saved';
                }
            });
        }

        // Calculate days active
        function calculateDaysActive(joinDate) {
            const now = new Date();
            const diffTime = Math.abs(now - joinDate);
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
            return diffDays;
        }

        // Determine community rank
        function getCommunityRank(daysActive, savedPostsCount) {
            if (daysActive >= 30 && savedPostsCount >= 10) return 'Leader';
            if (daysActive >= 7 && savedPostsCount >= 5) return 'Active';
            if (daysActive >= 3) return 'Member';
            return 'New';
        }

        // Sign out user
        function signOut() {
            // Clear Google session
            if (googleAuthLoaded && typeof google !== 'undefined') {
                google.accounts.id.disableAutoSelect();
            }
            
            // Clear state
            currentUser = null;
            localStorage.removeItem('iam_mugera_user');
            
            // Update UI
            updateUserInterface();
            
            showNotification('You have been signed out');
            console.log('User signed out');
        }

        // Event Listeners
        loginBtn.addEventListener('click', () => {
            authModal.classList.add('active');
        });

        closeModal.addEventListener('click', () => {
            authModal.classList.remove('active');
            // Reset fallback UI
            manualAuth.style.display = 'none';
            document.getElementById('googleSignInButton').style.display = 'block';
            customGoogleBtn.style.display = 'none';
        });

        authModal.addEventListener('click', (e) => {
            if (e.target === authModal) {
                authModal.classList.remove('active');
                // Reset fallback UI
                manualAuth.style.display = 'none';
                document.getElementById('googleSignInButton').style.display = 'block';
                customGoogleBtn.style.display = 'none';
            }
        });

        // Toggle fallback authentication
        toggleFallback.addEventListener('click', (e) => {
            e.preventDefault();
            manualAuth.style.display = manualAuth.style.display === 'none' ? 'block' : 'none';
        });

        // Custom Google button click (opens Google OAuth in new window)
        customGoogleBtn.addEventListener('click', () => {
            const googleAuthUrl = `https://accounts.google.com/o/oauth2/v2/auth?client_id=${GOOGLE_CLIENT_ID}&redirect_uri=${encodeURIComponent(window.location.origin)}&response_type=token&scope=email profile&state=google_auth`;
            window.open(googleAuthUrl, 'google_auth', 'width=500,height=600');
        });

        // Manual sign in
        manualSignIn.addEventListener('click', handleManualAuth);

        userProfileElement.addEventListener('click', () => {
            profileSection.scrollIntoView({ behavior: 'smooth' });
        });

        document.getElementById('editProfileBtn').addEventListener('click', () => {
            showNotification('Profile editing feature coming soon!');
        });

        document.getElementById('viewSavedBtn').addEventListener('click', () => {
            if (currentUser && currentUser.savedPosts) {
                const savedPosts = currentUser.savedPosts;
                if (savedPosts.length > 0) {
                    showNotification(`You have ${savedPosts.length} saved posts`);
                } else {
                    showNotification('You haven\'t saved any posts yet.');
                }
            }
        });

        logoutBtn.addEventListener('click', signOut);

        // Save button functionality
        document.querySelectorAll('.save-btn').forEach(button => {
            button.addEventListener('click', async function() {
                if (!currentUser) {
                    authModal.classList.add('active');
                    return;
                }
                
                const postId = this.getAttribute('data-post-id');
                const icon = this.querySelector('i');
                
                try {
                    if (icon.classList.contains('far')) {
                        // Save post
                        showLoading(this);
                        const result = await savePost(currentUser.userId, postId);
                        icon.classList.remove('far');
                        icon.classList.add('fas');
                        this.classList.add('active');
                        this.title = 'Remove from saved';
                        
                        // Update local state
                        if (!currentUser.savedPosts) currentUser.savedPosts = [];
                        currentUser.savedPosts.push(postId);
                        updateSavedPostsCount();
                        
                        showNotification('Post saved successfully!');
                        console.log(`Post ${postId} saved`);
                    } else {
                        // Remove saved post
                        showLoading(this);
                        const result = await unsavePost(currentUser.userId, postId);
                        icon.classList.remove('fas');
                        icon.classList.add('far');
                        this.classList.remove('active');
                        this.title = 'Save post';
                        
                        // Update local state
                        currentUser.savedPosts = currentUser.savedPosts.filter(id => id !== postId);
                        updateSavedPostsCount();
                        
                        showNotification('Post removed from saved');
                        console.log(`Post ${postId} removed from saved`);
                    }
                    
                    // Update localStorage
                    localStorage.setItem('iam_mugera_user', JSON.stringify(currentUser));
                } catch (error) {
                    console.error('Failed to update saved post:', error);
                    showNotification('Failed to update saved post. Please try again.', 'error');
                } finally {
                    hideLoading(this);
                }
            });
        });

        // Update saved posts count in profile
        function updateSavedPostsCount() {
            if (savedPostsCountElement && currentUser) {
                savedPostsCountElement.textContent = currentUser.savedPosts ? currentUser.savedPosts.length : 0;
                // Update community rank
                const joinDate = new Date(currentUser.createdAt || new Date());
                const daysActive = calculateDaysActive(joinDate);
                communityRankElement.textContent = getCommunityRank(daysActive, currentUser.savedPosts.length);
            }
        }

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            // Try to initialize Google Sign-In
            setTimeout(initializeGoogleSignIn, 1000);
            
            // Check for existing user session
            const savedUser = localStorage.getItem('iam_mugera_user');
            if (savedUser) {
                try {
                    currentUser = JSON.parse(savedUser);
                    updateUserInterface();
                    showNotification(`Welcome back, ${currentUser.name}!`);
                } catch (error) {
                    console.log('No valid session found');
                    localStorage.removeItem('iam_mugera_user');
                }
            }
            
            updateUserInterface();
            updatePostTimes();
            
            // Your existing initialization code...
        });

        // Your existing post time functionality
        const postDates = {
            'post-1': new Date('2025-11-15'),
            'post-2': new Date('2025-11-15'), 
            'post-3': new Date('2025-11-15')
        };

        function updatePostTimes() {
            const now = new Date();
            const today = new Date(now.getFullYear(), now.getMonth(), now.getDate());
            
            Object.keys(postDates).forEach(postId => {
                const postDate = new Date(postDates[postId]);
                const postDay = new Date(postDate.getFullYear(), postDate.getMonth(), postDate.getDate());
                const timeElement = document.getElementById(`${postId}-time`);
                
                if (timeElement) {
                    const diffTime = today - postDay;
                    const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24));
                    
                    if (diffDays === 0) {
                        timeElement.textContent = 'TODAY';
                    } else if (diffDays === 1) {
                        timeElement.textContent = '1 DAY AGO';
                    } else {
                        timeElement.textContent = `${diffDays} DAYS AGO`;
                    }
                }
            });
        }
    </script>
</body>
</html>
